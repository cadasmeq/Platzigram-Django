# django notes
install: pip3 install  django

# Initing Project
django-admin: es una interfaz de django.
$ django-admin startproject Platzigram		-> creación de projecto

# Project Scheme
<Platzigram>
0. manage.py		: permite ejecutar todos los comandos definidos e instalado en la aplicación del proyecto. (Entre ellas las del comando django-admin)
	1. __init__.py	: Iniciador de modulo de Python.
	2. asgi.py	: Sucesor espiritual de WSGI, para deployment Asincrono.
	3. settings.py	: Define todas las configuraciones del proyecto.
	4. url.py	: Punto de entrada para todas las peticiones que lleguen al  proyecto.
	5. wsgi.py	: Es utilizado para el deployment.

# Files detail
1. Settings.py
BASE_DIR		: Define la ubicación donde se está corriendo el proyecto.
SECRET_KEY		: Usado para el hashing de contraseñas y sesiones.
DEBUG			: Define si el proyecto esta en desarrollo.
ALLOWED_HOSTS		: Define que hosts estan permitidos para interactuar con el proyecto.
INSTALLED_APPS		: Aplicaciones ligadas al proyecto.
MIDDLEWARE		: Controles de seguridad utilizados en django.
ROOT_URLCONF		: Ubicación de las URLs.
TEMPLATES		: Ubicación de los templates.
WSGI_APPLICATION	: Ubicación principal del deployment.
DATABASES		: Configuración y conexión a BD.
AUTH_PASSWORD_VALIDATORS: Validadores de contraseñas. 

# Executing Project
$ python3 manage.py	-> Abre menú de opciones posibles para utilzar con django.
$ python3 manage.py runserver	-> inicia el server.

# Defining urls.
1. urls.py

- path("/hello", vista)		-> path() carga la url más la vista indicada.
- vista = function(request)	-> la vista es una función que recibe un request del cliente.
- function(request): 
	return HttpResponse(respuesta)	-> La respuesta puede es lo que se visualizará finalmente en la vista.

# Debugging Code
import pdb; pdb.set_trace()
dir(var)
var.methods
.. etc.

# Passing Params through the URL
1.- localhost:8000/<path>?numbers="1,3,6,8,9"

Directly from the url, I passed the arg <numbers>, to catch it, you must to do it in this way:

def <path_view>(request):
	catched_arg = request.GET['<ARG>']
	return HttpResponse(catched_arg)

# Sending Response as Json Content Type:
1. After catching from request our arg. You have to dump data into json format (a dict).
   You can do it manually:
  
   from django.http import JsonResponse
   def <path_view>(request):
	catched_arg = request.GET{'<ARG>']
	data = {
		'status':'ok',
		'arg':catched_arg,
	}
	return JsonResponse(data)

2. Second way is similar of the first one, only you have to dump the data using the json function and setting the content type as json.
  
   from django.http import HttpResponse
   import json
    def <view>(request):
	catched = request.GET['<ARG>']
	return HttpResponse(json.dumps({'data':catched}), content_type="application/json")
	
    # json.dumbs()  : Convert our data into a json format.
    # content_type(): Set content type header from response as json.

3. Correctly way to do it:
   
    def <view>(request):
	catched = request.GET['<ARG>']
	data = {
	   'status':'ok',
	   'data':catched,
	   'msg': 'data catched successfuly',
	}
        return HttpResponse(json.dumps(data), content_type="application/json")

# Path Converters
1. Path converters is the way how django capture info and convert it into a specific data type.
	i.e:
	path('example/<str:user>/<int:age>', views.example)

defining example view.
	def example(request, user, age):
		if  age > 18:
			msg = "above 18"
		else
			msg = "under"
		return HttpsResponse(msg)

# Creating an App.
1. Create an App in django means create a new python module that will provide us a set of new functionalities related between themself.
2. An app is a combination of models, views, urls, static files.

to create a new app:
$ python3 manage.py startapp posts

3. After create a new app, you must add it into settings.py on installed apps.
   'posts',

4. Using view.py of our app, you can create all views related.
   def list_post(request):
	list_posts = ListPosts()
	return HttpResponse(list_posts)

5. And finally, in our urls.py you can import this view and show it using path.

  from posts import views as posts_views
  
  path('posts', post_views.list_post)

# Template System
1. Template System of django, works similar to Jinja2.
2. Must be specified: 
	- request
	- template's name
	- context (dict)
3. By default, django's template system work for each app in /templates folder. (You can check this config in settings.py)

$ mkdir /Platzigram/posts/templates
$ touch 'feed.html'

posts/views.py
from django.shortcuts import render

def <x_view>(request):
	posts = POSTS()
	return render(request, 'feed.html', {'posts':posts})

in template you can use {{ var }} or {% for %} blocks similar to flask.

# Patrones de diseño
- Patron de diseño : Solución reutilizable a un problema común.
- Para el desarrollo web, es mayormente utilizado el patron de diseño MVC (Model View Controller).

1. MVC
- Controller	: Views + URL's
- Templates	: Views
- Modelo	: Define la estructura de los datos, acceso y validación.

2. Django implementa una solución similar, llamada Model Template View (MTV):
- Modelo	: Define estructura de los datos.
- Template	: Logica de la presentacion de los datos
- Views		: El encargado de decididir que template va a presentar lo sdatos y se encarga de pasarle esos datos al template.

# M en MTV
Configuración de BD en settings.py

DATABASES = {
	Engine	: Especifica la BD a utilizar.
}

1. Migraciones
Cambios existentes en la Base de Datos que no se han reflejado.
$ python3 manage.py migrate	: Ejecuta cambios de migraciones a la BD.

[note] : DB Browser para sqllite.

ORM (Object Relation Mapping)	: Es una técnica para trabajar con datos a través de multiples sistemas usando una abstracción de programación orientada a objetos.

2. Modelos de usuarios.
Django ya incluye un modelo de usuarios.
I.E:

models.py
from django.db import models

class User(models.Model):
	email = models.EmailField()
	password = models.CharField(max_len=25)
	
	first_name = models.CharField(max_len=25)
	last_name = models.CharField(max_len=25)
	
	bio = models.TextField()
	
	birthdate = models.DateField(blank=True, null=True)
	created = models.DateTimeField(auto_now_add=True)
	modified = models.DateTimeField(auto_now=True)

[note] :  referencias a los field de una base de datos verlas directamente en la documentación para ver que campos son compitables con la base de datos.

$ python3 manage.py makemigration	: Detecta nuevos cambios y genera archivo de backup
$ python3 manage.py migrate		: Migra los cambios a la BD.
